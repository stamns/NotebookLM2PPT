---
title: MinerU ä¼˜åŒ–
---

# MinerU æ·±åº¦ä¼˜åŒ–

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ NotebookLM2PPT ä¸­ MinerU æ·±åº¦ä¼˜åŒ–åŠŸèƒ½çš„æŠ€æœ¯å®ç°ç»†èŠ‚ï¼Œé€‚åˆæŠ€æœ¯äººå‘˜å‚è€ƒã€‚

## ğŸ§  æ ¸å¿ƒåŸç†

MinerU ä¼˜åŒ–åŠŸèƒ½é€šè¿‡è§£æ MinerU ç”Ÿæˆçš„ JSON æ–‡ä»¶ï¼Œæå–é¡µé¢ç»“æ„ä¿¡æ¯ï¼Œå¯¹åŸºç¡€è½¬æ¢ç”Ÿæˆçš„ PPT è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼Œæå‡æ’ç‰ˆè´¨é‡ã€å›¾ç‰‡æ¸…æ™°åº¦å’Œæ–‡æœ¬å‡†ç¡®æ€§ã€‚

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

**æ–‡ä»¶**: `notebooklm2ppt/utils/ppt_refiner.py`

**ä¸»è¦å‡½æ•°**:

```python
def refine_ppt(tmp_image_dir, json_file, ppt_file, png_dir, png_files, final_out_ppt_file, unify_font=None, font_name=None)
```

**å‚æ•°è¯´æ˜**:
- `tmp_image_dir`: ä¸´æ—¶å›¾ç‰‡ç›®å½•
- `json_file`: MinerU ç”Ÿæˆçš„ JSON æ–‡ä»¶è·¯å¾„
- `ppt_file`: åŸºç¡€è½¬æ¢ç”Ÿæˆçš„ PPT æ–‡ä»¶è·¯å¾„
- `png_dir`: PDF è½¬æ¢ç”Ÿæˆçš„ PNG å›¾ç‰‡ç›®å½•
- `png_files`: PNG æ–‡ä»¶åˆ—è¡¨
- `final_out_ppt_file`: æœ€ç»ˆè¾“å‡ºçš„ä¼˜åŒ–å PPT æ–‡ä»¶è·¯å¾„
- `unify_font`: æ˜¯å¦ç»Ÿä¸€å­—ä½“ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ï¼‰
- `font_name`: ç»Ÿä¸€ä½¿ç”¨çš„å­—ä½“åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º"å¾®è½¯é›…é»‘"ï¼‰

## ğŸ“Š ä¼˜åŒ–æµç¨‹

### 1. æ™ºèƒ½æ–‡æœ¬æ¡†ç­›é€‰

**é—®é¢˜**: åŸºç¡€è½¬æ¢å¯èƒ½ä¼šè¯†åˆ«å‡ºæ— å…³çš„æ–‡æœ¬æ¡†

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ IOUï¼ˆäº¤å¹¶æ¯”ï¼‰ç®—æ³•è¯„ä¼°æ–‡æœ¬æ¡†ä¸ PDF å†…å®¹å—çš„é‡å ç¨‹åº¦

**å®ç°**:
```python
def compute_iou(boxA, boxB):
    # è®¡ç®—ä¸¤ä¸ªçŸ©å½¢çš„äº¤é›†é¢ç§¯
    xA = max(boxA[0], boxB[0])
    yA = max(boxA[1], boxB[1])
    xB = min(boxA[2], boxB[2])
    yB = min(boxA[3], boxB[3])

    interWidth = max(0, xB - xA)
    interHeight = max(0, yB - yA)
    interArea = interWidth * interHeight

    boxAArea = (boxA[2] - boxA[0]) * (boxA[3] - boxA[1])
    boxBArea = (boxB[2] - boxB[0]) * (boxB[3] - boxB[1])

    iou = interArea / float(boxAArea + boxBArea - interArea)
    return iou
```

**ç­›é€‰é€»è¾‘**:
- è®¡ç®—æ¯ä¸ªæ–‡æœ¬æ¡†ä¸ PDF å†…å®¹å—çš„ IOU
- ä¿ç•™ IOU > 0.01 çš„æ–‡æœ¬æ¡†ï¼ˆç›¸å…³æ€§å¼ºï¼‰
- åˆ é™¤ IOU â‰¤ 0.01 çš„æ–‡æœ¬æ¡†ï¼ˆå¯èƒ½æ˜¯æ— å…³å…ƒç´ ï¼‰

### 2. å­—ä½“ç»Ÿä¸€å¤„ç†

**é—®é¢˜**: åŸºç¡€è½¬æ¢ç”Ÿæˆçš„ PPT ä¸­ï¼Œæ–‡æœ¬æ¡†å­—ä½“å¯èƒ½å„ä¸ç›¸åŒ

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€æ‰€æœ‰æ–‡æœ¬æ¡†å­—ä½“ä¸º"å¾®è½¯é›…é»‘"

**å®ç°**:
```python
# åˆ›å»ºå¾®è½¯é›…é»‘å­—ä½“å¯¹è±¡
newFont = TextFont("å¾®è½¯é›…é»‘")

# éå†æ–‡æœ¬æ¡†ä¸­çš„æ‰€æœ‰æ–‡æœ¬èŒƒå›´
for textRange in paragraph.TextRanges:
    textRange.LatinFont = newFont
```

### 3. é«˜è´¨é‡å›¾ç‰‡æ›¿æ¢

**é—®é¢˜**: åŸºç¡€è½¬æ¢è¿‡ç¨‹ä¸­å›¾ç‰‡å¯èƒ½è¢«å‹ç¼©æˆ–è´¨é‡é™ä½

**è§£å†³æ–¹æ¡ˆ**: ä» PDF æ¸²æŸ“çš„é«˜æ¸… PNG ä¸­è£å‰ªå‡ºåŸå§‹å›¾ç‰‡åŒºåŸŸå¹¶æ›¿æ¢

**å®ç°**:
```python
# è£å‰ªå¹¶ä¿å­˜ä¸´æ—¶å›¾ç‰‡
image_crop = image_cv[top_bg:bottom_bg, left_bg:right_bg]
Image.fromarray(image_crop).save(tmp_image_path)

# æ›¿æ¢ PPT ä¸­çš„å›¾ç‰‡
rect1 = RectangleF.FromLTRB(left, top + delta_y, right, bottom + delta_y)
image = slide.Shapes.AppendEmbedImageByPath(ShapeType.Rectangle, tmp_image_path, rect1)
image.Line.FillType = FillFormatType.none
image.ZOrderPosition = 0  # è®¾ç½®å›¾ç‰‡åœ¨æœ€åº•å±‚
```

### 4. æ™ºèƒ½èƒŒæ™¯å¤„ç†

**é—®é¢˜**: éœ€è¦å¹³è¡¡çº¯è‰²åŒºåŸŸå¡«å……å’Œå¤æ‚èƒŒæ™¯ä¿ç•™

**è§£å†³æ–¹æ¡ˆ**: åŸºäºè¾¹ç¼˜é¢œè‰²ä¸€è‡´æ€§ï¼ˆå¤šæ ·æ€§ï¼‰å’Œæ—§èƒŒæ™¯å¯ç”¨æ€§çš„æ™ºèƒ½åˆ¤æ–­

**å®ç°**:
```python
from notebooklm2ppt.utils.edge_diversity import compute_edge_diversity_numpy

diversity, fill_color = compute_edge_diversity_numpy(image_cv, left, top, right, bottom, tolerance=15)

if old_bg_cv is None or diversity < 0.5:
    # è¾¹ç¼˜é¢œè‰²è¾ƒä¸€è‡´ï¼ˆæ¥è¿‘çº¯è‰²ï¼‰æˆ–æ— æ—§èƒŒæ™¯ï¼Œç›´æ¥å¡«å……ä¸»è‰²
    image_cv[top:bottom, left:right] = fill_color
else:
    # è¾¹ç¼˜é¢œè‰²å˜åŒ–è¾ƒå¤§ï¼ˆå¤æ‚èƒŒæ™¯ï¼‰ï¼Œä¿ç•™åŸèƒŒæ™¯
    image_cv[top:bottom, left:right] = old_bg_cv[top:bottom, left:right]
```

å…¶ä¸­ï¼š
- `diversity` âˆˆ [0, 1]ï¼Œæ•°å€¼è¶Šå°è¡¨ç¤ºè¾¹ç¼˜é¢œè‰²è¶Šæ¥è¿‘å•ä¸€çº¯è‰²
- `fill_color` ä¸ºæ ¹æ®è¾¹ç¼˜ä¸»è‰²è®¡ç®—å¾—åˆ°çš„å¡«å……é¢œè‰²

## ğŸ“ˆ å®Œæ•´å·¥ä½œæµç¨‹

### 1. æ•°æ®å‡†å¤‡

```python
# 1. åŠ è½½ MinerU JSON
data = load_json(json_file)
pdf_info = data['pdf_info']

# 2. æ ¹æ®é¡µç ç­›é€‰ä¿¡æ¯
indices = get_indices_from_png_names(png_files)
pdf_info = [pdf_info[i] for i in indices]

# 3. è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
pdf_w, _ = pdf_info[0]['page_size']
presentation = Presentation()
presentation.LoadFromFile(ppt_file)
ppt_H, ppt_W = presentation.SlideSize.Size.Height, presentation.SlideSize.Size.Width
ppt_scale = ppt_W / pdf_w
```

### 2. é€é¡µå¤„ç†

```python
for page_index, slide in enumerate(presentation.Slides):
    # 1. æ™ºèƒ½æ–‡æœ¬æ¡†ç­›é€‰å’Œå­—ä½“ç»Ÿä¸€
    # 2. é«˜è´¨é‡å›¾ç‰‡æ›¿æ¢
    # 3. æ™ºèƒ½èƒŒæ™¯å¤„ç†
```

### 3. ä¿å­˜ç»“æœ

```python
presentation.SaveToFile(final_out_ppt_file, FileFormat.Pptx2019)
print(f"ä¼˜åŒ–å®Œæˆ! è¾“å‡ºæ–‡ä»¶: {final_out_ppt_file}")

# æ¸…ç† PPT
clean_ppt(final_out_ppt_file, final_out_ppt_file)
```

## ğŸ” å…³é”®ç®—æ³•

### IOUï¼ˆäº¤å¹¶æ¯”ï¼‰ç®—æ³•

**åº”ç”¨**: æ–‡æœ¬æ¡†ç­›é€‰
**åŸç†**: è®¡ç®—ä¸¤ä¸ªçŸ©å½¢åŒºåŸŸçš„é‡å ç¨‹åº¦
**é˜ˆå€¼**: 0.01ï¼ˆç»è¿‡å®éªŒéªŒè¯çš„åˆç†é˜ˆå€¼ï¼‰

### è¾¹ç¼˜å¤šæ ·æ€§æ£€æµ‹ç®—æ³•

**åº”ç”¨**: èƒŒæ™¯å¤„ç†
**åŸç†**: ç»Ÿè®¡æ–‡æœ¬å—å››æ¡è¾¹ç¼˜åƒç´ çš„ä¸»è‰²å æ¯”ï¼Œä¸»è‰²å æ¯”è¶Šé«˜ï¼Œå¤šæ ·æ€§è¶Šä½
**è¾“å‡º**:
- `diversity = 1 - main_ratio`ï¼Œ`main_ratio` ä¸ºä¸»è‰²å æ¯”
- `fill_color` ä¸ºä¸»è‰²å¯¹åº”çš„å¹³å‡ RGB é¢œè‰²
**é˜ˆå€¼**: 0.5ï¼ˆ`diversity < 0.5` æ—¶è®¤ä¸ºæ¥è¿‘çº¯è‰²åŒºåŸŸï¼Œå¯ç”¨ä¸»è‰²å¡«å……ï¼‰

## âš™ï¸ æŠ€æœ¯å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | ä½œç”¨ | å½±å“ |
|------|--------|------|------|
| **IOU é˜ˆå€¼** | 0.01 | æ–‡æœ¬æ¡†ç­›é€‰ | å½±å“æ–‡æœ¬æ¡†ä¿ç•™æ•°é‡ |
| **è¾¹ç¼˜å¤šæ ·æ€§é˜ˆå€¼** | 0.5 | èƒŒæ™¯å¤„ç† | è¶Šå°è¶Šå®¹æ˜“åˆ¤å®šä¸ºçº¯è‰²åŒºåŸŸ |
| **è¾¹ç¼˜é¢œè‰²å®¹å·®** | 15 | è¾¹ç¼˜é¢œè‰²é‡åŒ– | å®¹å·®è¶Šå¤§è¶Šä¸æ•æ„Ÿï¼Œä¸»è‰²æ›´ç¨³å®š |
| **å›¾ç‰‡ç¼“å­˜** | å¯ç”¨ | æ€§èƒ½ä¼˜åŒ– | å‡å°‘é‡å¤è£å‰ªæ“ä½œ |

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **å±€éƒ¨è£å‰ª**: ç›´æ¥ä»é«˜æ¸…é¡µé¢æ¸²æŸ“å›¾ä¸­è£å‰ªå›¾ç‰‡åŒºåŸŸï¼Œä¿è¯äº†å›¾ç‰‡ä¸èƒŒæ™¯çš„é«˜åº¦ä¸€è‡´æ€§ã€‚
2. **é€é¡µå¤„ç†**: ä»¥é¡µä¸ºå•ä½é¡ºåºå¤„ç†ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯•å’Œæ‰©å±•å¹¶è¡ŒåŒ–ã€‚
3. **å†…å­˜ç®¡ç†**: åˆ©ç”¨ Python åƒåœ¾å›æ”¶é€é¡µé‡Šæ”¾ä¸´æ—¶æ•°ç»„ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜ã€‚

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| **å›¾ç‰‡è£å‰ªä½ç½®åç§»** | ç¼©æ”¾æ¯”ä¾‹è®¡ç®—ä¸å‡†ç¡®æˆ– PDF å¸ƒå±€å¤æ‚ | æ£€æŸ¥ `ppt_scale` å’Œ `image_scale` è®¡ç®—é€»è¾‘ |
| **æ–‡æœ¬æ¡†ç­›é€‰ä¸å‡†ç¡®** | IOU é˜ˆå€¼ä¸åˆé€‚æˆ– JSON è§£æè´¨é‡å·® | è°ƒæ•´ IOU é˜ˆå€¼ï¼Œæ£€æŸ¥ JSON è´¨é‡ |
| **èƒŒæ™¯å¤„ç†æ•ˆæœä¸ç†æƒ³** | é˜ˆå€¼è®¾ç½®ä¸åˆé€‚ | è°ƒæ•´è¾¹ç¼˜å¤šæ ·æ€§é˜ˆå€¼æˆ–è¾¹ç¼˜é¢œè‰²å®¹å·® |
| **ä¼˜åŒ–é€Ÿåº¦æ…¢** | æ–‡æ¡£è¾ƒå¤§æˆ–é¡µé¢å›¾ç‰‡åˆ†è¾¨ç‡æé«˜ | é€‚å½“é™ä½ PNG æ¸²æŸ“åˆ†è¾¨ç‡ |

### è°ƒè¯•å»ºè®®

1. **å¯ç”¨è°ƒè¯•æ¨¡å¼**: è®¾ç½®ç¯å¢ƒå˜é‡ `NOTEBOOKLM2PPT_DEBUG=1`
2. **æ£€æŸ¥ JSON æ–‡ä»¶**: ç¡®è®¤ JSON æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«å®Œæ•´çš„é¡µé¢ä¿¡æ¯
3. **è°ƒæ•´é˜ˆå€¼**: æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ç®—æ³•é˜ˆå€¼ï¼ˆIOUã€å¤šæ ·æ€§ã€å®¹å·®ï¼‰

## ğŸ“š æŠ€æœ¯ä¾èµ–

- **Spire.Presentation**: ç”¨äº PPT æ“ä½œå’Œä¿®æ”¹
- **NumPy**: ç”¨äºæ•°å€¼è®¡ç®—ã€å›¾åƒæ•°ç»„æ“ä½œå’Œè¾¹ç¼˜é¢œè‰²ç»Ÿè®¡
- **Requests**: ç”¨äºä¸‹è½½ MinerU å›¾ç‰‡
- **Pillow**: ç”¨äºå›¾åƒè¯»å†™ä¸ç¼©æ”¾ï¼ˆèƒŒæ™¯å›¾å’Œé¡µé¢æˆªå›¾ï¼‰

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å·¥ä½œåŸç†](implementation)ï¼šäº†è§£æ•´ä½“å·¥ä½œæµç¨‹
- [å¿«é€Ÿå¼€å§‹](quickstart)ï¼šäº†è§£å¦‚ä½•ä½¿ç”¨ MinerU ä¼˜åŒ–
- [åŠŸèƒ½ä»‹ç»](features)ï¼šäº†è§£ MinerU ä¼˜åŒ–çš„æ ¸å¿ƒåŠŸèƒ½
